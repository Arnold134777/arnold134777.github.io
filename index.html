<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Arnold的技术博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="iOS开发,喜欢算法">
<meta property="og:type" content="website">
<meta property="og:title" content="Arnold的技术博客">
<meta property="og:url" content="www.arnold134777.com/index.html">
<meta property="og:site_name" content="Arnold的技术博客">
<meta property="og:description" content="iOS开发,喜欢算法">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Arnold的技术博客">
<meta name="twitter:description" content="iOS开发,喜欢算法">
  
    <link rel="alternative" href="/atom.xml" title="Arnold的技术博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/assert/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Arnold</a></h1>
		</hgroup>

		
		<p class="header-subtitle">iOS开发,喜欢算法(512509373@qq.com)</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://arnold134777.github.io/" title="github">github</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/GCD/" style="font-size: 10px;">GCD</a> <a href="/tags/LintCode/" style="font-size: 10px;">LintCode</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.sina.com.cn/u/2423600462">Arnold的新郎博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">iOS开发，喜欢算法</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Arnold</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/assert/avatar.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Arnold</h1>
			</hgroup>
			
			<p class="header-subtitle">iOS开发,喜欢算法(512509373@qq.com)</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://arnold134777.github.io/" title="github">github</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-MSWeakTimer机制解析" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/03/MSWeakTimer机制解析/" class="article-date">
  	<time datetime="2015-12-03T03:22:46.000Z" itemprop="datePublished">2015-12-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/03/MSWeakTimer机制解析/">MSWeakTimer机制解析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>MSWeakTimer地址：<a href="https://github.com/mindsnacks/MSWeakTimer" target="_blank" rel="external">https://github.com/mindsnacks/MSWeakTimer</a></p>
<p><strong>基本介绍</strong></p>
<p>线程安全的MSWeakTimer是NSTimer的替代品，最基本的特点是它不会 retain target 以及支持GCD queues。</p>
<p><strong>问题的提出</strong></p>
<p>关于 NSTimer 中 target 的生命周期问题，当 repeat 为 YES 时NSTimer 会 retains 它的 target，那么target的生命周期就成了问题，完全的交给了这个timer，只有当timer 调用invalidate后 dealloc 才有机会发生。</p>
<p>另一个问题是GCD，在苹果的官方文档中说的很清楚:</p>
<p>Special Considerations</p>
<p>You must send this message from the thread on which the timer was installed. If you send this message from another thread, the input source associated with the timer may not be removed from its run loop, which could prevent the thread from exiting properly.</p>
<p>invalidate必须由安装这个timer的线程发起，否则这个timer有可能不会从run loop中移除。这种情况会发生的一个情况就是：当这个线程是由 GCD 管理的。这是因为 NSTimer 依赖于当前线程的run loop, 而GCD完全是另外一回事，它不能确保timer的阻塞和invalidate是由同一个线程发起的，run loop和queue将会交织在一起，世界就乱了…</p>
<p><strong>而MSWeakTimer完全就不是用run loop实现的，所以就不用考虑那么多了，它可以与GCD和谐共存，被任意线程 install 和 invalidate。</strong></p>
<p><strong>源码分析</strong><br>（1）初始化<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((self = [<span class="keyword">super</span> init]))</span><br><span class="line">    &#123;</span><br><span class="line">        self.timeInterval = timeInterval;</span><br><span class="line">        self.target = target;</span><br><span class="line">        self.selector = selector;</span><br><span class="line">        self.userInfo = userInfo;</span><br><span class="line">        self.repeats = repeats;</span><br><span class="line"></span><br><span class="line">        NSString *privateQueueName = [NSString stringWithFormat:@<span class="string">"com.mindsnacks.msweaktimer.%p"</span>, self];</span><br><span class="line"> <span class="comment">// 1.创建串行队列</span></span><br><span class="line"> <span class="comment">// Dispatch queues created with the DISPATCH_QUEUE_SERIAL or a NULLattribute</span></span><br><span class="line"> <span class="comment">// invoke blocks serially in FIFO order.</span></span><br><span class="line">        self.privateSerialQueue = dispatch_queue_create([privateQueueName cStringUsingEncoding:NSASCIIStringEncoding], DISPATCH_QUEUE_SERIAL);</span><br><span class="line">        dispatch_set_target_queue(self.privateSerialQueue, dispatchQueue);</span><br><span class="line"> <span class="comment">// 2.dispatch_source 定时器</span></span><br><span class="line">        self.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER,</span><br><span class="line">                                            <span class="number">0</span>,</span><br><span class="line">                                            <span class="number">0</span>,</span><br><span class="line">                                            self.privateSerialQueue);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>（2）设置定时器的触发时间<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dispatch_source_set_timer(self.timer,</span><br><span class="line">                              dispatch_time(DISPATCH_TIME_NOW, intervalInNanoseconds),</span><br><span class="line">                              (uint64_t)intervalInNanoseconds,</span><br><span class="line">                              toleranceInNanoseconds</span><br><span class="line">                              );</span><br></pre></td></tr></table></figure></p>
<p>（3）设置定时器触发的事件<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__weak MSWeakTimer *weakSelf = self;</span><br><span class="line"></span><br><span class="line">   dispatch_source_set_event_handler(self.timer, ^&#123;</span><br><span class="line">       [weakSelf timerFired];</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   dispatch_resume(self.timer);</span><br></pre></td></tr></table></figure></p>
<p>（4）具体event<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if (OSAtomicAnd32OrigBarrier(1, &amp;_timerFlags.timerIsInvalidated)) // 原子操作</span><br><span class="line">   &#123;</span><br><span class="line">       return;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // We're not worried about this warning because the selector we're calling doesn't return a +1 object.</span><br><span class="line">   #pragma clang diagnostic push</span><br><span class="line">   #pragma clang diagnostic ignored "-Warc-performSelector-leaks"</span><br><span class="line">       [self.target performSelector:self.selector withObject:self];</span><br><span class="line">   #pragma clang diagnostic pop</span><br><span class="line"></span><br><span class="line">   if (!self.repeats)</span><br><span class="line">   &#123;</span><br><span class="line">       [self invalidate];</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>（5）释放<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)invalidate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// We check with an atomic operation if it has already been invalidated. Ideally we would synchronize this on the private queue,</span></span><br><span class="line">    <span class="comment">// but since we can't know the context from which this method will be called, dispatch_sync might cause a deadlock.</span></span><br><span class="line">    <span class="keyword">if</span> (!OSAtomicTestAndSetBarrier(<span class="number">7</span>, &amp;_timerFlags.timerIsInvalidated))</span><br><span class="line">    &#123;</span><br><span class="line">        dispatch_source_t timer = self.timer;</span><br><span class="line">        dispatch_async(self.privateSerialQueue, ^&#123;</span><br><span class="line">            dispatch_source_cancel(timer);</span><br><span class="line">            ms_release_gcd_object(timer);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>附：<br>OSAtomicAnd32OrigBarrier ： 用于原子操作的判断，出于线程安全考虑<br>OSAtomic原子操作：<a href="http://southpeak.github.io/blog/2014/10/17/osatomicyuan-zi-cao-zuo/" target="_blank" rel="external">http://southpeak.github.io/blog/2014/10/17/osatomicyuan-zi-cao-zuo/</a><br>GCD dispatch_source：<a href="http://www.cnblogs.com/sunfrog/p/3308766.html" target="_blank" rel="external">http://www.cnblogs.com/sunfrog/p/3308766.html</a> </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GCD/">GCD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/30/hello-world/" class="article-date">
  	<time datetime="2015-11-30T06:54:37.000Z" itemprop="datePublished">2015-11-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/30/hello-world/">Hello World</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start">Quick Start</h2><h3 id="Create_a_new_post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-iOS-内存泄漏处理" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/23/iOS-内存泄漏处理/" class="article-date">
  	<time datetime="2015-11-23T09:38:44.000Z" itemprop="datePublished">2015-11-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/23/iOS-内存泄漏处理/">iOS 内存泄漏处理</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h3 id="问题1：loadNibNamed">问题1：loadNibNamed</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> NSString *cellId = @<span class="string">"AboutTableViewCell"</span>;</span><br><span class="line">    AboutTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:cellId];</span><br><span class="line">    <span class="keyword">if</span>(!cell)</span><br><span class="line">    &#123;</span><br><span class="line">        cell = [[[NSBundle mainBundle]loadNibNamed:@<span class="string">"AboutTableViewCell"</span> owner:self options:nil] lastObject];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>原因：I suspect that your leak may be coming from the outlets in the nib. Note this phrase in the docs on loadNibNamed::<br>To establish outlet connections, this method uses the setValue:forKey: method, which may cause the object in the outlet to be retained automatically.<br>In other words, loadNibNamed sometimes imposes an extra retain because of the odd way key-value-coding works.</p>
<p>However, that is speculation, and there’s no need for it, because there’s no need for you to call loadNibNamed: in the first place!</p>
<p>You’re using a custom UITableViewCell subclass, designed in a nib? Then why not do this the normal way? Make a nib containing one top-level object: the cell. Design the cell in the nib, set its class, hook up its outlets etc. In your code, call registerNib:forCellReuseIdentifier: on the table view, to tell the table view about your nib. When you later call dequeueReusableCellWithIdentifier:, if there are no free cells in the reuse pile, the table view will load your nib and hand you cell. No muss, no fuss.</p>
<h3 id="问题2：imageWithRenderingMode">问题2：imageWithRenderingMode</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tabBarItem1.selectedImage = [[UIImage imageNamed:@<span class="string">"img_wifi_hl"</span>] imageWithRenderingMode:UIImageRenderingModeAlwaysOriginal ];</span><br></pre></td></tr></table></figure>
<p>暂时未找到解决办法</p>
<h3 id="问题3：id_bridge">问题3：id bridge</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (id)fetchSSIDInfo</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    NSArray *ifs = CFBridgingRelease(CNCopySupportedInterfaces());</span><br><span class="line">    id info = nil;</span><br><span class="line">    <span class="keyword">for</span> (NSString *ifnam in ifs) &#123;</span><br><span class="line">        info = CFBridgingRelease(CNCopyCurrentNetworkInfo((__bridge CFStringRef)ifnam));</span><br><span class="line">        <span class="keyword">if</span> (info &amp;&amp; [info count]) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CFBridgingRelease 替换掉原来的（id bridge）</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-LintCode-最大间距" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/23/LintCode-最大间距/" class="article-date">
  	<time datetime="2015-11-23T04:25:25.000Z" itemprop="datePublished">2015-11-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/23/LintCode-最大间距/">LintCode 最大间距</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><a href="http://www.lintcode.com/zh-cn/problem/maximum-gap/" target="_blank" rel="external">http://www.lintcode.com/zh-cn/problem/maximum-gap/</a></p>
<p>最大间距 查看运行结果 </p>
<p>给定一个未经排序的数组，请找出其排序表中连续两个要素的最大间距。</p>
<p>如果数组中的要素少于 2 个，请返回 0.</p>
<p>您在真实的面试中是否遇到过这个题？ Yes<br>样例<br>给定数组 [1, 9, 2, 5]，其排序表为 [1, 2, 5, 9]，其最大的间距是在 5 和 9 之间，= 4.</p>
<p>注意<br>可以假定数组中的所有要素都是非负整数，且最大不超过 32 位整数。</p>
<p>挑战<br>排序十分简单，但将使用 O(nlogn) 时间复杂度。请避免使用线性时间复杂度和空间。</p>
<p>##代码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * <span class="doctag">@param</span> nums: an array of integers</span><br><span class="line">     * <span class="doctag">@return</span>: the maximum difference</span><br><span class="line">     */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maximumGap</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">null</span> == nums || nums.length &lt; <span class="number">2</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">int</span> length = nums.length;</span><br><span class="line">		<span class="keyword">int</span> min = Integer.MAX_VALUE;</span><br><span class="line">		<span class="keyword">int</span> max = Integer.MIN_VALUE;   </span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; length;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(nums[i] &lt; min)</span><br><span class="line">			&#123;</span><br><span class="line">				min = nums[i];</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(nums[i] &gt; max)</span><br><span class="line">			&#123;</span><br><span class="line">				max = nums[i];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 桶的概念</span></span><br><span class="line">		<span class="keyword">int</span> bucketCapacity = (max - min) / length + <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">int</span> bucketNumber = (max - min) / bucketCapacity + <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">int</span>[] minBuckets = <span class="keyword">new</span> <span class="keyword">int</span>[bucketNumber];</span><br><span class="line">		<span class="keyword">int</span>[] maxBuckets = <span class="keyword">new</span> <span class="keyword">int</span>[bucketNumber];</span><br><span class="line">		<span class="keyword">int</span> maxDistance = <span class="number">0</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; bucketNumber;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			minBuckets[i] = Integer.MAX_VALUE;</span><br><span class="line">			maxBuckets[i] = Integer.MIN_VALUE;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; length;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> index = (nums[i] - min) / bucketCapacity;</span><br><span class="line">			<span class="keyword">if</span>(minBuckets[index] &gt; nums[i])</span><br><span class="line">			&#123;</span><br><span class="line">				minBuckets[index] = nums[i];</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(maxBuckets[index] &lt; nums[i])</span><br><span class="line">			&#123;</span><br><span class="line">				maxBuckets[index] = nums[i];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">int</span> pre = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; bucketNumber;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(minBuckets[i] == Integer.MAX_VALUE &amp;&amp; maxBuckets[i] == Integer.MIN_VALUE)</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span>(minBuckets[i] - maxBuckets[pre] &gt; maxDistance)</span><br><span class="line">			&#123;</span><br><span class="line">				maxDistance = minBuckets[i] - maxBuckets[pre]; <span class="comment">// 因为最大间距不可能在一个桶内，否则bucketNumber ＊ maxDistance &gt; length;</span></span><br><span class="line">			&#125;</span><br><span class="line">			pre = i;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span>  maxDistance;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LintCode/">LintCode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/算法/">算法</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Arnold
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>